{% load dict_lookup %}
{% load jsonify %}
{% load concat %}

<div id="nspanel_entities_page_{{ page.id }}" hx-swap-oob="true" hx-confirm='Do you want to delete this entity page? <p class="font-bold text-warning">All entities on this page will be removed.</p>' class="bg-base-200 rounded-box p-3 grid grid-cols-2 gap-4 w-full max-w-[24rem] aspect-square indicator">
    {% for i in range %}
        {% if entities|dict_lookup:i %}
            <div class="rounded-box border-neutral border-opacity-50 bg-neutral text-neutral-content border-dashed border-2 flex items-center justify-center indicator w-full h-full">
                {% with entity=entities|dict_lookup:i %}
                {% if entity.controlled_by_nspanel_main_page %}
                    <span class="indicator-item badge badge-secondary me-16 w-6 h-6 flex items-center justify-center" title="Controlled from main page" hx-swap="none" hx-get="#TODO"><span class="mdi mdi-home"></span></span>
                {% endif %}
                <button class="indicator-item badge badge-info me-8 w-6 h-6 flex items-center justify-center" title="Edit entity" hx-swap="none" hx-get="#TODO"><span class="mdi mdi-pencil"></span></button>
                <button class="indicator-item badge badge-warning hover:badge-error w-6 h-6 flex items-center justify-center" title="Remove entity from page/room" hx-confirm="Do you wish to remove '{{ entity.friendly_name }}' entity?" hx-swap="none" hx-get="{% url 'htmx_partial_remove_entity_from_page_slot' page_id=page.id slot_id=i %}"><span class="mdi mdi-close"></span></button>
                <span class="text-sm m-2">{{ entity.friendly_name }}</span>
                {% endwith %}
            </div>
        {% else %}
            <div class="rounded-box border-neutral border-opacity-50 border-dashed border-2 flex items-center justify-center indicator w-full h-full">
                <span class="font-thin italic">No entitiy set</span>
                {% concat_all '{"page_id": ' page.id ', "page_slot": ' i ', "room_id": ' page.room.id '}' as action_args %}
                <button class="btn btn-neutral hover:btn-success btn-xs btn-circle ms-2" title="Add entitiy" hx-confirm="unset" hx-get='{% url "htmx_partial_select_new_entity_type" action="ADD_ENTITY_TO_NSPANEL_ENTITY_PAGE" action_args=action_args %}' hx-target="#modal" hx-swap="outerHTML" hx-indicator="#modal_loading">
                    <span class="mdi mdi-plus"></span>
                </button>
            </div>
        {% endif %}
    {% endfor %}

    <button class="indicator-item indicator-bottom indicator-end badge badge-neutral hover:badge-error w-6 h-6 flex items-center justify-center" hx-swap="outerHTML" hx-target="#nspanel_entities_page_{{ page.id }}" title="Delete page" hx-delete="{% url 'htmx_partial_delete_entities_page' page_id=page.id %}">âœ•</button>
</div>
