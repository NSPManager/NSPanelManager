<script type="module">
  import { define, html } from '/static/node_modules/hybrids/src/index.js';

  stomp_subscribe("nspanel/{{ nspanel.mac_address }}/status", (message) => {
    var element = document.getElementById(`nspanel-status-text-{{ nspanel.id }}`);
    element.state = message.body;
  })

  define({
    tag: "nspanel-status-text",
    nspanel_id: '',
    name: '',
    state: '',
    update_progress: '',
    render: ({id, name, state, update_progress}) => {
      if (state == "online") {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Panel online">
                State: <span class="text-success">Online</span>
            </span>
        `;
      } else if (state == "offline") {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Panel offline">
                State: <span class="text-error">Offline</span>
            </span>
        `;
      } else if (state == "waiting") {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Waiting for panel status">
                State: <span class="text-info">Waiting</span>
            </span>
        `;
      } else if (state == "updating_fw") {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Waiting for panel status">
                State: <span class="text-info">Updating FW</span>
            </span>
        `;
      } else if (state == "updating_fs") {
              return html`
                  <span class="mdi mdi-power-cycle me-2" title="Waiting for panel status">
                      State: <span class="text-info">Updating FS</span>
                  </span>
              `;
      } else if (state == "updating_tft") {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Waiting for panel status">
                State: <span class="text-info">Updating TFT</span>
            </span>
        `;
      } else {
        return html`
            <span class="mdi mdi-power-cycle me-2" title="Waiting for panel status">
              State: <span class="text-warning">Unknown state ${state}</span>
            </span>
        `;
      }
    },
  })
</script>

<nspanel-status-text id="nspanel-status-text-{{ nspanel.id }}" nspanel_id="{{ nspanel.id }}" state=""></nspanel-status-badge>
