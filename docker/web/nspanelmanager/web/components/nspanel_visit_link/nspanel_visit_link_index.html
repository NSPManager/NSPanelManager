<script type="module">
  import { define, html } from '/static/node_modules/hybrids/src/index.js';

  stomp_subscribe("nspanel/{{ nspanel.mac_address }}/status", (message) => {
    var element = document.getElementById(`nspanel-visit-link-{{ nspanel.id }}`);
    var data = JSON.parse(message.body);
    element.state = data.state;
    element.address = data.ip_address;
  })

  define({
    tag: "nspanel-visit-link",
    nspanel_id: '',
    state: '',
    address: '',
    render: ({nspanel_id, state, address}) => {
      if (state == "offline" || address == '') {
        return html`
            <span title="No address available." class="block px-4 py-2 hover:bg-accent hover:text-accent-content line-through">
                <span class="mdi mdi-web pr-2"></span>Visit
            </span>
        `;
      } else {
        return html`
            <a href="http://${address}" target="_blank" class="nspanel-visit-link block px-4 py-2 hover:bg-accent hover:text-accent-content">
                <span class="mdi mdi-web pr-2"></span>Visit
            </a>
        `;
      }
    },
  })
</script>

<nspanel-visit-link id="nspanel-visit-link-{{ nspanel.id }}" nspanel_id="{{ nspanel.id }}" state="" address=""></nspanel-visit-link>
