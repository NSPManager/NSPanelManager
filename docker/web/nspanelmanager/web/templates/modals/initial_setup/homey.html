{% load static %}
<dialog id="welcome_modal" class="modal" hx-swap-oob="true">
  <div class="modal-box">
    <form method="dialog">
      <button class="absolute btn btn-sm btn-circle btn-ghost right-2 top-2">
        âœ•
      </button>
    </form>

    <div class="flex justify-center mb-2">
      <ul class="steps">
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_welcome' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          Welcome
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_manager_settings' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          Manager
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_mqtt_settings' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          MQTT
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_home_assistant_settings' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          Home Assistant
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_openhab_settings' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          OpenHAB
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_homey_settings' %}"
          hx-swap="none"
          class="cursor-pointer step step-primary"
        >
          Homey
        </li>
        <li
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_finished' %}"
          hx-swap="none"
          class="cursor-pointer step"
        >
          Finish
        </li>
      </ul>
    </div>

    <hr class="absolute left-0 w-full border-base-content" />

    <span class="block w-full mb-2 text-xl text-center"
      >Homey <span class="italic font-thin">(optional)</span></span
    >

    <form
      hx-post="{{ ingress_path }}{% url 'htmx_initial_setup_homey_settings' %}"
    >
      {% csrf_token %}

      <!-- Homey address -->
      <div class="w-full mb-2">
        <label for="homey_address" class="block mb-1 text-sm font-medium"
          >Homey address</label
        >
        <div class="flex flex-row-reverse w-full">
          <input
            class="outline-none rounded-e-field bg-base-300 border-neutral border border-l-0 focus:ring-0 focus:border-accent block flex-1 min-w-0 w-full text-sm p-2.5 peer/name"
            type="text"
            class="input"
            id="homey_address"
            name="homey_address"
            value="{{ homey_address }}"
          />
          <span
            class="inline-flex items-center px-3 text-sm border border-neutral rounded-e-0 rounded-s-field peer-focus/name:border-accent"
          >
            <span class="mdi mdi-web"></span>
          </span>
        </div>
      </div>

      <!-- Access Token -->
      <div class="w-full mb-2">
        <label for="homey_token" class="block mb-1 text-sm font-medium"
          >Homey token</label
        >
        <div class="flex flex-row-reverse w-full">
          <input
            class="outline-none rounded-e-field bg-base-300 border-neutral border border-l-0 focus:ring-0 focus:border-accent block flex-1 min-w-0 w-full text-sm p-2.5 peer/name"
            type="password"
            class="input"
            id="homey_token"
            name="homey_token"
            value="{{ homey_token }}"
          />
          <span
            class="inline-flex items-center px-3 text-sm border border-neutral rounded-e-0 rounded-s-field peer-focus/name:border-accent"
          >
            <span class="mdi mdi-web"></span>
          </span>
        </div>
      </div>

      <div class="flex justify-end mt-4">
        <button
          type="button"
          class="btn btn-neutral me-2"
          hx-get="{{ ingress_path }}{% url 'htmx_initial_setup_openhab_settings' %}"
        >
          Back
        </button>
        <button type="submit" class="btn btn-success">Next</button>
      </div>
    </form>
  </div>

  <!-- Backdrop that closes dialog/modal on click -->
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>

  <script>
    htmx.on("htmx:afterSwap", (e) => {
      if (e.detail.elt.id == "welcome_modal") {
        welcome_modal.showModal();
      }
    });
  </script>
</dialog>
